@using MailKit;

@if (LatestThreadMessage is null)
{
	<p>Načítava sa...</p>
}
else
{
	<div class="thread-row @(seen ? "seen" : "")">
		<input type="checkbox" checked="@IsChecked" @onchange="OnCheckUncheck" />
		<div class="cols" @onclick="OnClick">
			<div class="from @(seen ? "" : "bold")">@LatestThreadMessage.Envelope.From.Mailboxes.First().Name</div>
			<div class="preview-text">
				<span class="subject @(seen ? "" : "bold")">@LatestThreadMessage.NormalizedSubject</span>-@LatestThreadMessage.PreviewText
			</div>
			<div class="date @(seen ? "" : "bold")">@LatestThreadMessage.Date.LocalDateTime.ToShortDateString()</div>
		</div>
	</div>
}

@code {
	private bool seen;

	[Parameter]
	public IMessageSummary LatestThreadMessage { get; set; } = null!;

	[Parameter]
	public bool IsChecked { get; set; }

	[Parameter]
	public EmailManager EmailManager { get; set; } = null!;

	[Parameter]
	public EventCallback OnClick { get; set; }

	[Parameter]
	public EventCallback OnCheckUncheck { get; set; }

	protected override void OnParametersSet()
	{
		base.OnParametersSet();

		if (LatestThreadMessage.Flags.HasValue)
		{
			seen = LatestThreadMessage.Flags.Value.HasFlag(MessageFlags.Seen);
		}
	}
}
